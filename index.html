<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>स्पिन और जीतो</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* मुख्य स्टाइलिंग */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        h1 {
            margin: 0;
            color: #333;
            font-size: 2.5rem;
        }
        
        /* लॉगिन सेक्शन */
        #login-section {
            text-align: center;
            margin: 30px auto;
            max-width: 400px;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .login-btn {
            background-color: #4285F4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            transition: all 0.3s;
        }
        
        .login-btn:hover {
            background-color: #3367D6;
            transform: translateY(-2px);
        }
        
        /* यूजर सेक्शन */
        #user-section {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .logout-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background-color: #c82333;
        }
        
        /* वॉलेट सेक्शन */
        .wallet-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .balance {
            font-size: 2rem;
            font-weight: bold;
            color: #28a745;
            margin: 10px 0;
        }
        
        /* स्पिन सेक्शन */
        #spin-section {
            display: none;
            text-align: center;
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        #spin-button {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 30px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        
        #spin-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        
        #spin-button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* व्हील डिज़ाइन */
        #wheel-container {
            width: 300px;
            height: 300px;
            margin: 0 auto;
            position: relative;
        }
        
        #wheel {
            width: 100%;
            height: 100%;
            transition: transform 3s cubic-bezier(0.17, 0.67, 0.21, 0.99);
        }
        
        #spin-pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 30px solid red;
            z-index: 10;
        }
        
        /* निकासी सेक्शन */
        .withdraw-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .withdraw-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            transition: all 0.3s;
        }
        
        .withdraw-btn:hover {
            background-color: #218838;
        }
        
        /* रेफरल सेक्शन */
        .referral-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .referral-code {
            font-weight: bold;
            color: #007bff;
            font-size: 1.2rem;
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 5px;
            display: inline-block;
            margin: 10px 0;
            word-break: break-all;
        }
        
        .copy-btn {
            background-color: #17a2b8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }
        
        .copy-btn:hover {
            background-color: #138496;
        }
        
        /* फुटर */
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            background: linear-gradient(135deg, #333, #000);
            color: white;
            border-radius: 10px;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .footer-links a {
            color: white;
            margin: 0 15px;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .footer-links a:hover {
            color: #FFD700;
        }
        
        .social-icons {
            font-size: 24px;
            margin: 15px 0;
        }
        
        .social-icons a {
            color: white;
            margin: 0 10px;
            transition: all 0.3s;
        }
        
        .social-icons a:hover {
            color: #FFD700;
            transform: translateY(-3px);
        }
        
        /* पॉपअप स्टाइलिंग */
        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #FFD700, #FFA500);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            z-index: 1000;
            text-align: center;
            max-width: 90%;
            width: 400px;
            animation: popupIn 0.4s ease-out;
        }
        
        @keyframes popupIn {
            from { opacity: 0; transform: translate(-50%, -60%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }
        
        .popup h2 {
            margin-top: 0;
            color: #333;
        }
        
        .popup p {
            font-size: 1.2rem;
            margin: 15px 0;
        }
        
        .popup button {
            background-color: #333;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .popup button:hover {
            background-color: #555;
        }
        
        /* रिस्पॉन्सिव डिज़ाइन */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            #wheel-container {
                width: 250px;
                height: 250px;
            }
            
            #spin-button {
                padding: 12px 30px;
                font-size: 1rem;
            }
            
            .footer-links a {
                margin: 0 10px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-trophy"></i> स्पिन और जीतो</h1>
            <p>घुमाओ और असली पैसे जीतो!</p>
        </header>
        
        <!-- लॉगिन सेक्शन -->
        <div id="login-section">
            <h2>आपका स्वागत है</h2>
            <p>खेलने और पैसे कमाने के लिए गूगल से लॉगिन करें</p>
            <button class="login-btn" id="google-login-btn">
                <i class="fab fa-google" style="margin-right: 10px;"></i> गूगल से लॉगिन करें
            </button>
        </div>
        
        <!-- यूजर सेक्शन -->
        <div id="user-section">
            <div class="user-info">
                <div>
                    <h3>नमस्ते, <span id="user-name"></span></h3>
                    <p><i class="fas fa-envelope"></i> <span id="user-email"></span></p>
                </div>
                <button class="logout-btn" id="logout-btn"><i class="fas fa-sign-out-alt"></i> लॉगआउट</button>
            </div>
        </div>
        
        <!-- वॉलेट सेक्शन -->
        <div class="wallet-section">
            <h3><i class="fas fa-wallet"></i> आपका वॉलेट</h3>
            <p>बैलेंस: <span class="balance" id="user-balance">0</span> ₹</p>
            <p>कुल कमाई: <span class="balance" id="total-earned">0</span> ₹</p>
        </div>
        
        <!-- स्पिन सेक्शन -->
        <div id="spin-section">
            <h2><i class="fas fa-redo"></i> व्हील घुमाएं</h2>
            <p>हर 6 घंटे में एक बार घुमाएं और पैसे जीतें!</p>
            <div id="wheel-container">
                <div id="wheel"></div>
                <div id="spin-pointer"></div>
            </div>
            <button id="spin-button"><i class="fas fa-sync-alt"></i> SPIN NOW</button>
            <p id="spin-timer"></p>
        </div>
        
        <!-- निकासी सेक्शन -->
        <div class="withdraw-section">
            <h3><i class="fas fa-rupee-sign"></i> पैसे निकालें</h3>
            <p>न्यूनतम निकासी राशि: ₹500</p>
            <div class="form-group">
                <label for="withdraw-amount"><i class="fas fa-money-bill-wave"></i> राशि (₹)</label>
                <input type="number" id="withdraw-amount" min="500" placeholder="500">
            </div>
            <div class="form-group">
                <label for="payment-method"><i class="fas fa-money-check-alt"></i> भुगतान विधि</label>
                <select id="payment-method">
                    <option value="UPI" selected>UPI</option>
                    <option value="Paytm">Paytm</option>
                    <option value="Bank Transfer">बैंक ट्रांसफर</option>
                </select>
            </div>
            <div class="form-group" id="upi-id-container">
                <label for="upi-id"><i class="fas fa-mobile-alt"></i> UPI ID</label>
                <input type="text" id="upi-id" placeholder="yourname@upi">
            </div>
            <button class="withdraw-btn" id="withdraw-btn"><i class="fas fa-hand-holding-usd"></i> निकासी अनुरोध</button>
        </div>
        
        <!-- रेफरल सेक्शन -->
        <div class="referral-section">
            <h3><i class="fas fa-user-friends"></i> दोस्तों को भेजें और कमाएं</h3>
            <p>प्रत्येक सफल रेफरल के लिए ₹10 कमाएं!</p>
            <p>आपका रेफरल कोड:</p>
            <div class="referral-code" id="referral-code">LOADING...</div>
            <p>अपना लिंक शेयर करें:</p>
            <div class="referral-code" id="referral-link">LOADING...</div>
            <button class="copy-btn" id="copy-referral-btn"><i class="fas fa-copy"></i> लिंक कॉपी करें</button>
        </div>
        
        <!-- फुटर -->
        <footer>
            <div class="footer-links">
                <a href="/terms.html"><i class="fas fa-file-contract"></i> नियम और शर्तें</a>
                <a href="/privacy.html"><i class="fas fa-lock"></i> गोपनीयता नीति</a>
                <a href="/faq.html"><i class="fas fa-question-circle"></i> सामान्य प्रश्न</a>
                <a href="/contact.html"><i class="fas fa-envelope"></i> संपर्क करें</a>
            </div>
            <div class="social-icons">
                <a href="#"><i class="fab fa-facebook"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-telegram"></i></a>
                <a href="#"><i class="fab fa-whatsapp"></i></a>
            </div>
            <p>&copy; 2023 स्पिन और जीतो. सर्वाधिकार सुरक्षित.</p>
        </footer>
    </div>

    <!-- फायरबेस और मुख्य जावास्क्रिप्ट -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <script>
        // फायरबेस कॉन्फिगरेशन
        const firebaseConfig = {
            apiKey: "AIzaSyCzQgiXSB8-p0aXFmFFi65Ks11uZWj0KX0",
            authDomain: "spin-and-win-2026.firebaseapp.com",
            databaseURL: "https://spin-and-win-2026-default-rtdb.firebaseio.com",
            projectId: "spin-and-win-2026",
            storageBucket: "spin-and-win-2026.appspot.com",
            messagingSenderId: "369303979305",
            appId: "1:369303979305:web:08b2c9eaf670c471842338",
            measurementId: "G-MFZH0J437W"
        };
        
        // फायरबेस इनिशियलाइज़
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const provider = new firebase.auth.GoogleAuthProvider();

        // ग्लोबल वेरिएबल्स
        let currentUser = null;
        let userData = null;
        
        // डॉम तैयार होने पर
        document.addEventListener('DOMContentLoaded', function() {
            initializeWheel();
            setupEventListeners();
            checkAuthState();
        });

        // इवेंट लिसनर्स सेटअप
        function setupEventListeners() {
            document.getElementById('google-login-btn').addEventListener('click', loginWithGoogle);
            document.getElementById('logout-btn').addEventListener('click', logoutUser);
            document.getElementById('spin-button').addEventListener('click', spinWheel);
            document.getElementById('withdraw-btn').addEventListener('click', requestWithdraw);
            document.getElementById('copy-referral-btn').addEventListener('click', copyReferralLink);
            document.getElementById('payment-method').addEventListener('change', toggleUpiField);
        }

        // ऑथ स्टेट चेक
        function checkAuthState() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    loadUserData();
                    updateUIForLoggedInUser();
                } else {
                    currentUser = null;
                    updateUIForLoggedOutUser();
                }
            });
        }

        // व्हील इनिशियलाइज़ेशन
        function initializeWheel() {
            const wheel = document.getElementById('wheel');
            const prizes = [
                { color: '#FF6384', text: '₹5' },
                { color: '#36A2EB', text: '₹10' },
                { color: '#FFCE56', text: '₹20' },
                { color: '#4BC0C0', text: '₹50' },
                { color: '#9966FF', text: '₹100' },
                { color: '#FF9F40', text: '₹5' },
                { color: '#8AC24A', text: '₹10' },
                { color: '#E03997', text: '₹20' }
            ];
            
            let wheelHTML = '';
            const segmentAngle = 360 / prizes.length;
            
            prizes.forEach((prize, index) => {
                const angle = segmentAngle * index;
                wheelHTML += `
                    <div style="
                        position: absolute;
                        width: 50%;
                        height: 50%;
                        background: ${prize.color};
                        transform-origin: bottom right;
                        transform: rotate(${angle}deg) skewY(${90 - segmentAngle}deg);
                        overflow: hidden;
                    ">
                        <span style="
                            position: absolute;
                            right: 10px;
                            top: 10px;
                            transform: rotate(${segmentAngle/2}deg);
                            color: white;
                            font-weight: bold;
                            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
                        ">${prize.text}</span>
                    </div>
                `;
            });
            
            wheel.innerHTML = wheelHTML;
            wheel.style.width = '100%';
            wheel.style.height = '100%';
            wheel.style.position = 'relative';
            wheel.style.borderRadius = '50%';
            wheel.style.overflow = 'hidden';
            wheel.style.border = '5px solid #333';
        }

        // गूगल लॉगिन
        function loginWithGoogle() {
            auth.signInWithPopup(provider)
                .then((result) => {
                    // लॉगिन सफल
                }).catch((error) => {
                    console.error("लॉगिन एरर:", error);
                    showErrorPopup("लॉगिन असफल: " + error.message);
                });
        }

        // लॉगआउट
        function logoutUser() {
            auth.signOut().then(() => {
                // लॉगआउट सफल
            }).catch((error) => {
                console.error("लॉगआउट एरर:", error);
                showErrorPopup("लॉगआउट में समस्या आई");
            });
        }

        // यूजर डेटा लोड करें
        function loadUserData() {
            const userRef = database.ref('users/' + currentUser.uid);
            userRef.on('value', (snapshot) => {
                userData = snapshot.val();
                if (!userData) {
                    createNewUser();
                } else {
                    updateUserDisplay();
                }
            });
        }

        // नया यूजर बनाएं
        function createNewUser() {
            const userRef = database.ref('users/' + currentUser.uid);
            const newUser = {
                username: currentUser.displayName || currentUser.email.split('@')[0],
                email: currentUser.email,
                balance: 10, // नए यूजर को 10 रुपये बोनस
                totalEarned: 10,
                totalWithdrawn: 0,
                referralCode: generateReferralCode(),
                referredBy: getUrlParameter('ref'),
                spinCount: 0,
                lastSpin: null,
                createdAt: new Date().toISOString()
            };
            
            userRef.set(newUser).then(() => {
                if (newUser.referredBy) {
                    processReferral(newUser.referredBy);
                }
                showSuccessPopup("आपको ₹10 का साइनअप बोनस मिला है!");
            });
        }

        // UI अपडेट (लॉगिन)
        function updateUIForLoggedInUser() {
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('user-section').style.display = 'block';
            document.getElementById('spin-section').style.display = 'block';
            
            // UPI फील्ड टॉगल
            toggleUpiField();
        }

        // UI अपडेट (लॉगआउट)
        function updateUIForLoggedOutUser() {
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('user-section').style.display = 'none';
            document.getElementById('spin-section').style.display = 'none';
        }

        // यूजर डिस्प्ले अपडेट
        function updateUserDisplay() {
            if (userData) {
                document.getElementById('user-name').textContent = userData.username;
                document.getElementById('user-email').textContent = userData.email;
                document.getElementById('user-balance').textContent = userData.balance.toFixed(2);
                document.getElementById('total-earned').textContent = userData.totalEarned.toFixed(2);
                document.getElementById('referral-code').textContent = userData.referralCode;
                document.getElementById('referral-link').textContent = 
                    window.location.origin + window.location.pathname + '?ref=' + userData.referralCode;
                
                checkSpinAvailability();
            }
        }

        // स्पिन व्हील घुमाएं
        function spinWheel() {
            if (!canSpin()) return;
            
            const spinButton = document.getElementById('spin-button');
            spinButton.disabled = true;
            spinButton.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> घूम रहा है...';
            
            const spinResult = calculateSpinResult();
            const spinDuration = 2000 + Math.random() * 3000;
            
            const wheel = document.getElementById('wheel');
            wheel.style.transition = 'transform ' + (spinDuration/1000) + 's cubic-bezier(0.17, 0.67, 0.21, 0.99)';
            wheel.style.transform = 'rotate(' + (360 * 5 + spinResult.angle) + 'deg)';
            
            setTimeout(() => {
                const updates = {
                    balance: userData.balance + spinResult.points,
                    totalEarned: userData.totalEarned + spinResult.points,
                    spinCount: userData.spinCount + 1,
                    lastSpin: new Date().toISOString()
                };
                
                database.ref('users/' + currentUser.uid).update(updates)
                    .then(() => {
                        showRewardPopup(spinResult);
                        checkSpinAvailability();
                    });
            }, spinDuration);
        }

        // स्पिन उपलब्धता चेक
        function canSpin() {
            if (!userData.lastSpin) return true;
            
            const lastSpin = new Date(userData.lastSpin);
            const now = new Date();
            const hoursSinceLastSpin = (now - lastSpin) / (1000 * 60 * 60);
            
            return hoursSinceLastSpin >= 6;
        }

        // स्पिन टाइमर अपडेट
        function checkSpinAvailability() {
            const spinButton = document.getElementById('spin-button');
            if (canSpin()) {
                spinButton.disabled = false;
                spinButton.innerHTML = '<i class="fas fa-sync-alt"></i> SPIN NOW';
                document.getElementById('spin-timer').textContent = '';
            } else {
                spinButton.disabled = true;
                const lastSpin = new Date(userData.lastSpin);
                const nextSpin = new Date(lastSpin.getTime() + 6 * 60 * 60 * 1000);
                const timeLeft = Math.floor((nextSpin - new Date()) / 1000 / 60);
                
                if (timeLeft > 0) {
                    const hours = Math.floor(timeLeft / 60);
                    const minutes = timeLeft % 60;
                    document.getElementById('spin-timer').textContent = `अगली स्पिन: ${hours} घंटे ${minutes} मिनट में`;
                    spinButton.innerHTML = '<i class="fas fa-clock"></i> इंतज़ार करें';
                    
                    // टाइमर अपडेट
                    const timerInterval = setInterval(() => {
                        const now = new Date();
                        if (now >= nextSpin) {
                            clearInterval(timerInterval);
                            checkSpinAvailability();
                        }
                    }, 60000); // हर मिनट अपडेट
                }
            }
        }

        // निकासी अनुरोध
        function requestWithdraw() {
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const paymentMethod = document.getElementById('payment-method').value;
            const upiId = document.getElementById('upi-id').value;
            
            if (isNaN(amount)) {
                showErrorPopup("कृपया सही राशि डालें");
                return;
            }
            
            if (amount < 500) {
                showErrorPopup("न्यूनतम निकासी राशि ₹500 है");
                return;
            }
            
            if (amount > userData.balance) {
                showErrorPopup("आपके पास पर्याप्त बैलेंस नहीं है");
                return;
            }
            
            if (paymentMethod === 'UPI' && !upiId) {
                showErrorPopup("कृपया अपना UPI ID डालें");
                return;
            }
            
            const withdrawData = {
                amount: amount,
                status: 'pending',
                timestamp: new Date().toISOString(),
                paymentMethod: paymentMethod,
                paymentDetails: paymentMethod === 'UPI' ? upiId : '',
                userEmail: userData.email,
                userName: userData.username
            };
            
            // लोडिंग दिखाएं
            const withdrawBtn = document.getElementById('withdraw-btn');
            withdrawBtn.disabled = true;
            withdrawBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> प्रोसेसिंग...';
            
            database.ref('withdraws/' + currentUser.uid).push(withdrawData)
                .then(() => {
                    // यूजर बैलेंस अपडेट करें
                    return database.ref('users/' + currentUser.uid).update({
                        balance: userData.balance - amount,
                        totalWithdrawn: userData.totalWithdrawn + amount
                    });
                })
                .then(() => {
                    showSuccessPopup(`₹${amount} का निकासी अनुरोध सफलतापूर्वक भेजा गया!`);
                    document.getElementById('withdraw-amount').value = '';
                    document.getElementById('upi-id').value = '';
                })
                .catch(error => {
                    console.error("निकासी एरर:", error);
                    showErrorPopup("निकासी में समस्या आई. कृपया बाद में प्रयास करें.");
                })
                .finally(() => {
                    withdrawBtn.disabled = false;
                    withdrawBtn.innerHTML = '<i class="fas fa-hand-holding-usd"></i> निकासी अनुरोध';
                });
        }

        // रेफरल लिंक कॉपी करें
        function copyReferralLink() {
            const referralLink = document.getElementById('referral-link').textContent;
            navigator.clipboard.writeText(referralLink)
                .then(() => {
                    showSuccessPopup("रेफरल लिंक कॉपी हो गया!");
                })
                .catch(err => {
                    console.error('कॉपी करने में असफल: ', err);
                    showErrorPopup('लिंक मैन्युअली कॉपी करें: ' + referralLink);
                });
        }

        // UPI फील्ड टॉगल
        function toggleUpiField() {
            document.getElementById('upi-id-container').style.display = 
                document.getElementById('payment-method').value === 'UPI' ? 'block' : 'none';
        }

        // रेफरल प्रोसेस
        function processReferral(referralCode) {
            const usersRef = database.ref('users');
            const referralQuery = usersRef.orderByChild('referralCode').equalTo(referralCode);
            
            referralQuery.once('value').then((snapshot) => {
                if (snapshot.exists()) {
                    const referrerId = Object.keys(snapshot.val())[0];
                    const referrerUpdates = {
                        referralCount: (snapshot.val()[referrerId].referralCount || 0) + 1,
                        balance: (snapshot.val()[referrerId].balance || 0) + 10,
                        totalEarned: (snapshot.val()[referrerId].totalEarned || 0) + 10
                    };
                    
                    database.ref('users/' + referrerId).update(referrerUpdates)
                        .then(() => {
                            showSuccessPopup("आपको ₹10 का रेफरल बोनस मिला है!");
                        });
                }
            });
        }

        // रिवॉर्ड पॉपअप
        function showRewardPopup(result) {
            const popup = document.createElement('div');
            popup.className = 'popup';
            popup.innerHTML = `
                <h2><i class="fas fa-trophy"></i> बधाई हो!</h2>
                <p>आपने जीता: ₹${result.points.toFixed(2)}</p>
                <button onclick="this.parentElement.remove()"><i class="fas fa-times"></i> बंद करें</button>
            `;
            document.body.appendChild(popup);
            
            // 5 सेकंड बाद ऑटो क्लोज
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.remove();
                }
            }, 5000);
        }

        // सक्सेस पॉपअप
        function showSuccessPopup(message) {
            const popup = document.createElement('div');
            popup.className = 'popup';
            popup.style.background = 'linear-gradient(135deg, #28a745, #218838)';
            popup.style.color = 'white';
            popup.innerHTML = `
                <h2><i class="fas fa-check-circle"></i> सफलता!</h2>
                <p>${message}</p>
                <button onclick="this.parentElement.remove()" style="background-color: white; color: #28a745;">
                    <i class="fas fa-thumbs-up"></i> ठीक
                </button>
            `;
            document.body.appendChild(popup);
            
            // 5 सेकंड बाद ऑटो क्लोज
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.remove();
                }
            }, 5000);
        }

        // एरर पॉपअप
        function showErrorPopup(message) {
            const popup = document.createElement('div');
            popup.className = 'popup';
            popup.style.background = 'linear-gradient(135deg, #dc3545, #c82333)';
            popup.style.color = 'white';
            popup.innerHTML = `
                <h2><i class="fas fa-exclamation-triangle"></i> त्रुटि!</h2>
                <p>${message}</p>
                <button onclick="this.parentElement.remove()" style="background-color: white; color: #dc3545;">
                    <i class="fas fa-times"></i> बंद करें
                </button>
            `;
            document.body.appendChild(popup);
            
            // 5 सेकंड बाद ऑटो क्लोज
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.remove();
                }
            }, 5000);
        }

        // स्पिन रिजल्ट कैलकुलेट
        function calculateSpinResult() {
            const prizes = [
                { points: 5, probability: 0.4, angle: 0 },
                { points: 10, probability: 0.3, angle: 45 },
                { points: 20, probability: 0.2, angle: 90 },
                { points: 50, probability: 0.08, angle: 135 },
                { points: 100, probability: 0.02, angle: 180 }
            ];
            
            let random = Math.random();
            let cumulativeProbability = 0;
            
            for (const prize of prizes) {
                cumulativeProbability += prize.probability;
                if (random <= cumulativeProbability) {
                    return prize;
                }
            }
            
            return prizes[0];
        }

        // रेफरल कोड जनरेट
        function generateReferralCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        // URL पैरामीटर पढ़ें
        function getUrlParameter(name) {
            name = name.replace(/[[]/, '\\[').replace(/[\]]/, '\\]');
            const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            const results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }
    </script>
</body>
</html>
